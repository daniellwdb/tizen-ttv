"use strict";(()=>{var g="https://api.betterttv.net/3",k=async e=>{if(!e)return[];try{let t=await fetch(`${g}/cached/users/twitch/${e}`);if(!t.ok)throw Error();let n=await t.json();return[...n.channelEmotes,...n.sharedEmotes].map(a=>({id:a.id,code:a.code,channelId:e}))}catch{return[]}},x=async()=>{try{let e=await fetch(`${g}/cached/emotes/global`);if(!e.ok)throw Error();return(await e.json()).map(t=>({id:t.id,code:t.code,channelId:null}))}catch{return[]}};var y="https://api.frankerfacez.com/v1",E=async e=>{if(!e)return[];try{let t=await fetch(`${y}/room/id/${e}`);if(!t.ok)throw Error();let n=await t.json();return Object.values(n.sets).map(a=>a.emoticons.map(o=>({id:`${o.id}`,code:o.name,channelId:e}))).flat()}catch{return[]}},_=async()=>{try{let e=await fetch(`${y}/set/global`);if(!e.ok)throw Error();let t=await e.json();return Object.values(t.sets).map(n=>n.emoticons.map(a=>({id:`${a.id}`,code:a.name,channelId:null}))).flat()}catch{return[]}};var S=e=>({channelId:null,...e,providers:{twitch:!0,bttv:!0,ffz:!0,seventv:!0,...e?.providers}});var C=async(e,t={})=>e.map(n=>{let a=Object.values(t).findIndex(o=>o.includes(n.position));if(a>=0&&!n.emote){let o=Object.keys(t)[a];return{...n,emote:{images:["1.0","2.0","3.0"].map(l=>`https://static-cdn.jtvnw.net/emoticons/v2/${o}/default/dark/${l}`)}}}return n}),L={provider:"twitch",parse:C,load:async()=>{}},p=(e,t,n)=>{let a=[],o=async(l,i=!1)=>{a.find(r=>r.channelId===l)&&!i||(a=[...a,...(await Promise.all(t.map(r=>r(l)))).flat()])};return{provider:e,parse:async(l,i,r)=>(await o(r.channelId,!1),l.map(c=>{let s=a.find(d=>d.code==c.content&&(d.channelId==r.channelId||d.channelId==null));return s?{...c,emote:{images:n(s.id),isZeroWidth:s.isZeroWidth}}:c})),load:o}},T=p("bttv",[k,x],e=>["1x","2x","3x"].map(t=>`https://cdn.betterttv.net/emote/${e}/${t}`)),O=p("ffz",[E,_],e=>["1","2","4"].map(t=>`https://cdn.frankerfacez.com/emote/${e}/${t}`)),w="https://7tv.io/v3",P=async e=>{if(!e)return[];try{let t=await fetch(`${w}/users/twitch/${e}`);if(!t.ok)throw Error();return(await t.json()).emote_set.emotes.map(n=>({id:n.id,code:n.name,isZeroWidth:(n.flags||0)!==0,channelId:e}))}catch{return[]}},M=async()=>{try{let e=await fetch(`${w}/emote-sets/global`);if(!e.ok)throw Error();return(await e.json()).emotes.map(t=>({id:t.id,code:t.name,isZeroWidth:(t.flags||0)!==0,channelId:null}))}catch{return[]}},H=p("seventv",[P,M],e=>["1x","2x","3x","4x"].map(t=>`https://cdn.7tv.app/emote/${e}/${t}.webp`)),q={provider:"seventv",parse:async e=>e.reduce(async(t,n,a,o)=>{let l=await t;return n.emote&&!n.emote.isZeroWidth&&(n.emote.overlays||(n.emote.overlays=[]),o.slice(a+1).some(i=>{var r,c;if(i.emote&&i.emote.isZeroWidth)(c=(r=n?.emote)==null?void 0:r.overlays)==null||c.push({images:i.emote.images,alt:i.content}),o.splice(a+1,1);else return!0})),l},Promise.resolve(e)),load:async()=>{}},f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"},W=e=>(Object.keys(f).map(t=>{let n=f[t];e=e.replaceAll(t,n)}),e),U=[L,T,O,H,q],b=async(e,t=null,n=null)=>{let a=t||{},o=S(n),l=await U.reduce(async(i,r)=>{var c;let s=await i;return(c=o.providers)!=null&&c[r.provider]?r.parse(s,a,o):s},z(e));return{toArray:()=>l,toHTML:(i=1,r=!0,c=!0)=>l.map(s=>{var d,m;if(!s.emote)return c?W(s.content):s.content;let $=((d=s.emote.images)==null?void 0:d[i])||s.emote.images[0],h=[24,28,32,48][i],I=[6,8,10,20][i]*-1,j=(((m=s.emote)==null?void 0:m.overlays)||[]).map(u=>{var v;return`<img class="emotettv-overlay" ${r?`style="position:absolute;top:0;left:0;height:${h}px"`:""} src="${((v=u.images)==null?void 0:v[i])||u.images[0]}" alt="${u.alt}" />`}).join("");return`<figure class="emotettv-emote" ${r?'style="position:relative;display:inline-block;margin:0"':""}><img class="emotettv-img" src="${$}" alt="${s.content}" ${r?`style="height:${h}px;margin-bottom:${I}px"`:""} />${j}</figure>`}).join(" ")}},z=async e=>{let t=0;return e.split(" ").map(n=>{let a=`${t}-${t+n.length-1}`;return t+=n.length+1,{content:n,position:a}})};var A="ue6666qo983tsx6so1t0vnawi233wa",N="https://gql.twitch.tv/gql",Z=setInterval(()=>{let e=document.querySelector(".css-175oi2r"),t=new URL(document.URL).pathname.replace("/","");e&&t&&(R(),clearInterval(Z))},250);async function R(){let e=document.querySelector(".css-175oi2r"),n=await fetch(N,{method:"POST",headers:{"content-type":"application/json","Client-Id":A},body:JSON.stringify({query:`
    query useChannelSubscriptionPolling_SubscriptionQuery(
      $login: String
    ) {
      user(login: $login) {
        ...useChannelSubscriptionPolling_subscription
        id
        __typename
      }
    }

    fragment useChannelSubscriptionPolling_subscription on User {
      login
      self {
        subscriptionBenefit {
          id
          __typename
        }
      }
    }
  `,variables:{login:new URL(document.URL).pathname.replace("/","")}})}),{data:a}=await n.json();new MutationObserver(l=>{for(let i of l)i.addedNodes.forEach(async r=>{let c=r.childNodes[0];if(!c)return;let s=c.childNodes[c.childNodes.length-1];if(s instanceof HTMLSpanElement){let d=await b(s.textContent,void 0,{channelId:a.user.id,providers:{twitch:!0,bttv:!1,ffz:!1,seventv:!0}});s.innerHTML=d.toHTML()}})}).observe(e,{childList:!0,subtree:!0})}})();
